---
title: "生存分析案例报告"
date: 2025-04-13
---

引言
生存分析是一种统计方法，用于研究某个事件发生的时间分布。在本案例中，我们使用IBM的电信客户流失数据，通过生存分析方法（包括Kaplan-Meier、Cox比例风险模型和加速失效时间模型）来预测客户流失的时间，并将其结果应用于客户生命周期价值（CLV）的计算。
数据准备
1.数据来源：使用IBM提供的电信客户流失数据集，包含客户的人口统计信息、服务计划、媒体使用情况和订阅状态。
2.关键变量：
-tenure：客户在公司停留的月数（如果仍在订阅）或流失前的月数。
-churn：布尔值，表示客户是否仍在订阅。
3.数据预处理：
-数据被存储为Delta Lake的青铜表和银表。
-银表对原始数据进行了清洗和筛选，例如过滤出月度合同的互联网用户。
分析方法
1.Kaplan-Meier方法
-目的：构建生存概率曲线，评估客户流失的时间分布。
-结果：
变量级别的生存曲线分析
1.性别（Gender）：
-生存曲线显示，男性和女性客户的流失概率随时间变化的趋势相似。
-Log-rank检验的p值为0.204476，表明性别对客户流失没有显著影响。
2.高级公民（Senior Citizen）：
-生存曲线显示，高级公民的流失概率略高于非高级公民。
-Log-rank检验的p值为2.523624e-12，表明高级公民状态对客户流失有显著影响。
3.伴侣（Partner）：
-生存曲线显示，有伴侣的客户流失概率略低于无伴侣的客户。
-Log-rank检验的p值为5.063437e-58，表明伴侣状态对客户流失有显著影响。
4.是否有受抚养人（Dependents）：
-生存曲线显示，有受抚养人的客户流失概率略低于无受抚养人的客户。
-Log-rank检验的p值为0.000251，表明是否有受抚养人对客户流失有显著影响。
5.电话服务（Phone Service）：
-生存曲线显示，使用电话服务的客户流失概率略高于不使用电话服务的客户。
-Log-rank检验的p值为0.377599，表明电话服务对客户流失没有显著影响。
6.多条线路（Multiple Lines）：
-生存曲线显示，使用多条线路的客户流失概率略低于未使用的客户。
-Log-rank检验的p值为3.190116e-11，表明多条线路对客户流失有显著影响。
7.互联网服务（Internet Service）：
-生存曲线显示，使用光纤互联网服务的客户流失概率略高于使用DSL的客户。
-Log-rank检验的p值为2.369872e-20，表明互联网服务类型对客户流失有显著影响。
8.流媒体电视（Streaming TV）：
-生存曲线显示，使用流媒体电视的客户流失概率略高于未使用的客户。
-Log-rank检验的p值为1.813974e-32，表明流媒体电视对客户流失有显著影响。
9.流媒体电影（Streaming Movies）：
-生存曲线显示，使用流媒体电影的客户流失概率略高于未使用的客户。
-Log-rank检验的p值为6.484901e-39，表明流媒体电影对客户流失有显著影响。
10.在线安全（Online Security）：
-生存曲线显示，使用在线安全服务的客户流失概率略低于未使用的客户。
-Log-rank检验的p值为3.138886e-18，表明在线安全对客户流失有显著影响。
11.在线备份（Online Backup）：
-生存曲线显示，使用在线备份服务的客户流失概率略低于未使用的客户。
-Log-rank检验的p值为2.620909e-67，表明在线备份对客户流失有显著影响。
12.设备保护（Device Protection）：
-生存曲线显示，使用设备保护服务的客户流失概率略低于未使用的客户。
-Log-rank检验的p值为7.904692e-39，表明设备保护对客户流失有显著影响。
13.技术支持（Tech Support）：
-生存曲线显示，使用技术支持服务的客户流失概率略低于未使用的客户。
-Log-rank检验的p值为3.468692e-07，表明技术支持对客户流失有显著影响。
14.无纸化账单（Paperless Billing）：
-生存曲线显示，使用无纸化账单的客户流失概率略高于未使用的客户。
-Log-rank检验的p值为5.000937e-07，表明无纸化账单对客户流失有显著影响。
15.支付方式（Payment Method）：
-生存曲线显示，不同支付方式的客户流失概率存在差异。
-Log-rank检验结果表明，支付方式对客户流失有显著影响。
-结论：Kaplan-Meier方法适合单变量分析，能直观展示不同客户群体的生存概率差异。
显著影响客户流失的变量：高级公民、伴侣、受抚养人、多条线路、互联网服务、流媒体电视、流媒体电影、在线安全、在线备份、设备保护、技术支持和无纸化账单。
无显著影响的变量：性别和电话服务。

2.Cox比例风险模型
目的
进行多变量分析，评估不同变量对客户流失风险的影响。
结果
模型总结
-模型：lifelines.CoxPHFitter
-持续时间列：'tenure'
-事件列：'churn'
-基线估计：breslow
-观测数量：3351
-观测事件数量：1556
-部分对数似然：-11315.95
-时间拟合运行：2023-08-17 05:32:43 UTC
变量分析


-一致性指数 (Concordance)：0.64
-部分AIC：22639.90
-似然比检验：337.77（4个自由度）
-似然比检验的-log2(p)：236.24
比例风险假设检验


Schoenfeld残差图
-dependents_Yes：p值为0.3680（rank-transformed time）和0.2232（km-transformed time），表明比例风险假设成立。
-internetService_DSL：p值为0.0000（rank-transformed time）和0.0000（km-transformed time），表明比例风险假设不成立。
-onlineBackup_Yes：p值为0.0000（rank-transformed time）和0.0000（km-transformed time），表明比例风险假设不成立。
-techSupport_Yes：p值为0.0002（rank-transformed time）和0.0044（km-transformed time），表明比例风险假设不成立。
结论
-模型性能：Cox比例风险模型的一致性指数为0.64，表明模型具有中等的预测能力。
-显著变量：dependents_Yes、internetService_DSL、onlineBackup_Yes和techSupport_Yes对客户流失风险有显著影响。
-比例风险假设：dependents_Yes符合比例风险假设，而其他变量（internetService_DSL、onlineBackup_Yes、techSupport_Yes）违反了比例风险假设。对于这些变量，可以考虑使用分层模型或引入时间依赖变量来改进模型。
建议
-模型改进：对于违反比例风险假设的变量，可以尝试分层模型或引入时间依赖变量。
-业务应用：利用模型结果优化客户保留策略，特别是在早期阶段，以提高客户生命周期价值（CLV）。

3.加速失效时间模型（AFT）
-目的：通过参数化方法建模客户流失时间。
-结果：
模型方程与假设
-模型方程：AFT模型通过加速失效率（λ）来建模生存时间。模型方程显示，生存函数与加速失效率的乘积决定了不同组别的生存概率。
-假设验证：通过Log-Log Kaplan-Meier图验证AFT模型的假设。如果模型假设成立，曲线应保持平行。
变量分析
-设备保护（Device Protection）：
o生存曲线显示，使用设备保护服务的客户流失概率略低于未使用的客户。
oLog-Log Kaplan-Meier图显示，曲线在大部分时间点上保持平行，表明模型假设成立。
-互联网服务（Internet Service）：
o生存曲线显示，使用光纤互联网服务的客户流失概率略高于使用DSL的客户。
oLog-Log Kaplan-Meier图显示，曲线在大部分时间点上保持平行，表明模型假设成立。
-在线安全（Online Security）：
o生存曲线显示，使用在线安全服务的客户流失概率略低于未使用的客户。
oLog-Log Kaplan-Meier图显示，曲线在大部分时间点上保持平行，表明模型假设成立。
-在线备份（Online Backup）：
o生存曲线显示，使用在线备份服务的客户流失概率略低于未使用的客户。
oLog-Log Kaplan-Meier图显示，曲线在大部分时间点上保持平行，表明模型假设成立。
-技术支持（Tech Support）：
o生存曲线显示，使用技术支持服务的客户流失概率略低于未使用的客户。
oLog-Log Kaplan-Meier图显示，曲线在大部分时间点上保持平行，表明模型假设成立。
-支付方式（Payment Method）：
o生存曲线显示，不同支付方式的客户流失概率存在差异。
oLog-Log Kaplan-Meier图显示，曲线在大部分时间点上保持平行，表明模型假设成立。
模型输出
-Log-Logistic AFT模型：
o模型输出显示，所有变量的p值均小于0.05，表明这些变量对客户流失有显著影响。
o模型的协变量（Concordance）为0.73，表明模型具有较好的预测能力。
o模型的AIC值为13698.72，可用于与其他模型的比较。
-结论：
显著影响客户流失的变量：设备保护、互联网服务、在线安全、在线备份、技术支持和支付方式。
模型假设验证：Log-Log Kaplan-Meier图显示，AFT模型的假设在大部分变量上成立，表明模型适合用于分析客户流失时间。
4.客户生命周期价值（CLV）计算
-概述：客户生命周期价值（CLV）是指一个客户在其整个生命周期内为企业带来的预期净现值（NPV）。在本报告中，我们通过生存分析模型的输出，计算了客户的生存概率，并将其应用于客户生命周期价值的计算。
-数据与方法
-数据来源：使用IBM的电信客户流失数据集，包含客户的人口统计信息、服务计划、媒体使用情况和订阅状态。
-生存分析模型：使用Cox比例风险模型和加速失效时间（AFT）模型，预测客户的流失时间。
-客户生命周期价值计算：
o生存概率：从生存分析模型中提取的客户在每个月的生存概率。
o月度利润：假设每个客户的月度利润为30美元。
o内部收益率（IRR）：设定为10%（年化），用于计算净现值（NPV）。
-结果：
-生存概率曲线：
o生存概率随时间的增加而逐渐下降，表明客户流失的风险随时间增加。
o在第12个月，客户的生存概率约为0.59；在第24个月，约为0.45；在第36个月，约为0.35。
-累计净现值（NPV）：
o在第12个月，累计NPV约为251.40美元。
o在第24个月，累计NPV约为383.78美元。
o在第36个月，累计NPV约为415.76美元。
-客户生命周期价值表格：
o以下是客户生命周期价值的详细表格，展示了每个月的生存概率、月度利润、平均预期月利润、NPV和累计NPV。

图表展示
1.生存概率曲线：
-生存概率随合同月份的增加而逐渐下降，表明客户流失的风险随时间增加。
2.累计NPV柱状图：
-在第12个月，累计NPV约为251.40美元。
-在第24个月，累计NPV约为383.78美元。
-在第36个月，累计NPV约为415.76美元。
结论
-客户价值随时间变化：客户的生命周期价值随时间的增加而逐渐增加，但增速逐渐放缓。
-优化客户保留策略：通过提高客户保留率，特别是在早期阶段，可以显著提升客户的累计NPV。
-业务决策支持：这些结果可以用于优化客户获取成本（CAC）与客户生命周期价值（CLV）的平衡，从而提高整体业务盈利能力。

结论
1.生存分析方法的选择：
-Kaplan-Meier适合单变量分析，Cox模型适合多变量分析，AFT模型适合参数化建模。
-选择方法时需考虑模型假设和业务目标（如推断或预测）。
2.业务应用：
-生存分析的结果可以用于优化客户保留策略、预测客户流失时间以及计算客户生命周期价值。
3.下一步：
-进一步探索Cox模型的改进方法（如分层模型、时间依赖变量）。
-将生存分析结果应用于更广泛的业务决策中
